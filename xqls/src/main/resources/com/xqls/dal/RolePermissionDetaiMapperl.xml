<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.xqls.dal.service.RolePermissionDetailMapper">
	<resultMap id="RoleResultMap" type="com.xqls.dal.model.RolePermissionDetail">
		<id column="row_id" property="rowId" jdbcType="VARCHAR" />
		<result column="role_id" jdbcType="VARCHAR" property="roleId" />
	    <result column="role_name" jdbcType="VARCHAR" property="roleName" />
		<result column="perm_id" jdbcType="VARCHAR" property="permId" />
		<result column="perm_name" jdbcType="VARCHAR" property="permName" />
		<result column="parent_id" jdbcType="VARCHAR" property="parentId" />
		<result column="url" jdbcType="VARCHAR" property="url" />
		<result column="img_class" jdbcType="VARCHAR" property="imgClass" />
	</resultMap>

	<select id="getListByMap" parameterType="java.util.Map"
		resultMap="RoleResultMap">
		SELECT rp.perm_id row_id,
               r.role_id role_id,
               r.role_name role_name,
               p.perm_id perm_id,
               p.perm_name perm_name,
               p.parent_id parentId,
               p.url url,
               p.img_class img_class
       FROM role_permission rp
       LEFT JOIN permission p ON rp.perm_id=p.perm_id
       LEFT JOIN role r ON rp.role_id=r.role_id
       WHERE 1=1
       <if test="rowId!=null">
        AND row_id=#{rowId,jdbcType=VARCHAR}
       </if>
       <if test="roleName!=null">
        AND r.role_name=#{roleName,jdbcType=VARCHAR}
       </if>
       <if test="parentId!=null">
        AND p.parent_id=#{parentId,jdbcType=VARCHAR}
       </if>
       <if test="permName!=null">
        AND p.perm_Name=#{permName,jdbcType=VARCHAR}
       </if>
       ORDER BY p.parent_id,p.level
	</select>
</mapper>